<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live User Panel</title>
<!-- Include Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  /* Existing dark mode styles */
  body.dark-mode {
    background-color: #121212;
    color: #ffffff;
  }
  .dark-mode .card {
    background-color: #272727;
    color: #ffffff;
  }
  .dark-mode .table {
    border-color: #424242;
  }
  .dark-mode .table th,
  .dark-mode .table td {
    border-color: #424242;
    color: #ffffff; /* Ensure text is white */
  }

  
  /* Add more dark mode styles as needed */
</style>
<!-- Include Socket.IO -->
<script src="/socket.io/socket.io.js"></script>
</head>
<body>

<div class="container mt-4">
  <!-- Dark Mode Toggle Button -->
  <button id="darkModeToggle" class="btn btn-secondary mb-3">Toggle Dark Mode</button>

  <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
          <span>Live Connections</span>
      <img src="/logo_webcro.png" alt="Logo" width="60" height="60">
          <span id="activeUserCount" class="badge bg-success">Active Users: 0</span>
      </div>
      <div class="card-body">
          <table class="table" id="connectionsTable">
              <thead>
                  <tr>
                      <th scope="col">Status</th>
                      <th scope="col">IP</th>
                      <th scope="col">Page</th>
                      <th scope="col">Stage</th>
                      <th scope="col">Updated</th>
                  </tr>
              </thead>
              <tbody>
                  <!-- User rows will be dynamically inserted here -->
              </tbody>
          </table>
      </div>
  </div>
</div>

<!-- Bootstrap 5 JS and Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
 const socket = io();

    socket.on('join', (users) => {
        updateConnectionsTable(users);
        updateActiveUserCount(users.length); // Update the count of active users
    });

    socket.on('leave', (user) => {
        console.log('User leave:', user);
        // Additional logic to remove the user from the table, if necessary
    });

    function updateConnectionsTable(users) {
        const tableBody = document.getElementById('connectionsTable').querySelector('tbody');
        tableBody.innerHTML = ''; // Clear existing rows

        users.forEach(([ipAddress, details]) => {
            const row = document.createElement('tr');
            let color = null
            if(details.status == 'actif'){
              color = 'success'
            } else {
              color = 'danger'
            }
            row.innerHTML = `
                <td><span class="badge bg-${color}">${details.status}</span></td>
                <td>${ipAddress}</td>
                <td>${details.page || ''}</td>
                <td>${details.stage || ''}</td>
                <td></td> <!-- Updated column -->
            `;

            tableBody.appendChild(row);
        });
    }

    function updateActiveUserCount(newCount) {
        document.getElementById('activeUserCount').textContent = `Active Users: ${newCount}`;
    }

    document.getElementById('darkModeToggle').addEventListener('click', function() {
        const isDarkMode = document.body.classList.contains('dark-mode');
        if (isDarkMode) {
            this.textContent = 'Toggle Dark Mode';
            document.body.classList.remove('dark-mode');
        } else {
            this.textContent = 'Toggle Light Mode';
            document.body.classList.add('dark-mode');
        }
        
        // Update table header colors
        const headers = document.querySelectorAll('#connectionsTable th');
        headers.forEach(header => {
            if (isDarkMode) {
                header.style.color = ''; // Reset to default color
            } else {
                header.style.color = '#ffffff'; // Set to white for dark mode
            }
        });
    });
</script>

</body>
</html>
